<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa del Sitio - Mandarín a Español</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #f5f5f5;
            color: #1a1a2e;
            overflow: hidden;
            height: 100vh;
        }

        /* ── Top nav (shared) ── */
        .top-nav {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 200;
            background: #1a1a2e;
            display: flex;
            align-items: center;
            padding: 0;
            height: 38px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        .top-nav .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0 1rem;
            height: 100%;
            border-right: 1px solid rgba(255,255,255,0.1);
            text-decoration: none;
            color: #D4A843;
            font-weight: 700;
            font-size: 0.82rem;
            white-space: nowrap;
        }
        .top-nav .nav-brand .char {
            width: 22px; height: 22px;
            background: #C41E3A;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 0.75rem;
        }
        .top-nav a.nav-link {
            padding: 0 1rem;
            height: 100%;
            display: flex;
            align-items: center;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.5);
            text-decoration: none;
            transition: all 0.15s;
            border-bottom: 2px solid transparent;
        }
        .top-nav a.nav-link:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .top-nav a.nav-link.active {
            color: #fff;
            border-bottom-color: #C41E3A;
            background: rgba(255,255,255,0.06);
        }

        /* ── Toolbar ── */
        .toolbar {
            position: fixed;
            top: 38px; left: 0; right: 0;
            z-index: 100;
            background: linear-gradient(135deg, #C41E3A 0%, #8B1528 100%);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.45rem 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            gap: 0.6rem;
            flex-wrap: wrap;
        }
        .toolbar .title-area {
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
        }
        .toolbar-controls {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            flex-wrap: wrap;
        }
        .toolbar button {
            background: rgba(255,255,255,0.15);
            border: 1px solid rgba(255,255,255,0.3);
            color: #fff;
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.72rem;
            transition: background 0.15s;
        }
        .toolbar button:hover { background: rgba(255,255,255,0.3); }
        .toolbar .zoom-display {
            font-size: 0.72rem;
            min-width: 3rem;
            text-align: center;
            opacity: 0.9;
        }
        .toolbar .sep {
            width: 1px;
            height: 18px;
            background: rgba(255,255,255,0.25);
            margin: 0 0.15rem;
        }
        .toolbar .hint {
            font-size: 0.62rem;
            opacity: 0.6;
        }

        /* ── Canvas area ── */
        .canvas-wrap {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            padding-top: 82px;
            overflow: hidden;
            cursor: grab;
            background:
                radial-gradient(circle, #e8e8e8 1px, transparent 1px);
            background-size: 20px 20px;
        }
        .canvas-wrap.dragging { cursor: grabbing; }

        #diagram-container {
            position: absolute;
            transform-origin: 0 0;
            transition: none;
            padding: 40px;
        }
        #diagram-container.smooth-transition {
            transition: transform 0.3s ease;
        }

        .mermaid svg { display: block; }

        /* ── Info overlay ── */
        .info-overlay {
            position: fixed;
            bottom: 12px;
            left: 12px;
            z-index: 100;
            background: rgba(26,26,46,0.85);
            color: #fff;
            padding: 0.45rem 0.7rem;
            border-radius: 7px;
            font-size: 0.65rem;
            line-height: 1.5;
            backdrop-filter: blur(4px);
            max-width: 260px;
        }
        .info-overlay kbd {
            background: rgba(255,255,255,0.2);
            padding: 0.08rem 0.3rem;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.62rem;
        }

        /* ── Modal ── */
        .modal-overlay {
            position: fixed;
            inset: 0;
            z-index: 500;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(3px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .modal-overlay.open { display: flex; }

        .modal-box {
            background: #fff;
            border-radius: 10px;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 8px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.8rem 1.2rem;
            background: #1a1a2e;
            color: #fff;
        }
        .modal-header h3 {
            font-size: 0.9rem;
            font-weight: 600;
        }
        .modal-header h3 span { color: #D4A843; }
        .modal-close {
            background: rgba(255,255,255,0.15);
            border: none;
            color: #fff;
            width: 28px; height: 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s;
        }
        .modal-close:hover { background: rgba(255,255,255,0.3); }
        .modal-body {
            overflow-y: auto;
            padding: 1.2rem;
            flex: 1;
        }
        .modal-body pre {
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 0.78rem;
            line-height: 1.6;
            color: #1a1a2e;
            white-space: pre;
            overflow-x: auto;
        }
        .modal-footer {
            padding: 0.6rem 1.2rem;
            background: #f5f5f5;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-footer span {
            font-size: 0.65rem;
            color: #888;
        }
        .modal-footer button {
            background: #C41E3A;
            color: #fff;
            border: none;
            padding: 0.35rem 0.8rem;
            border-radius: 5px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.15s;
        }
        .modal-footer button:hover { background: #a01830; }
    </style>
</head>
<body>

<!-- ══ Shared top nav ══ -->
<div class="top-nav">
    <a href="mapa-del-sitio.html" class="nav-brand">
        <span class="char">橘</span> Mandarín a Español
    </a>
    <a href="mapa-del-sitio.html" class="nav-link active">Mapa del Sitio</a>
    <a href="mockups-wireframe.html" class="nav-link">Wireframes</a>
</div>

<!-- ══ Toolbar ══ -->
<div class="toolbar">
    <span class="title-area">Mapa del Sitio (interactivo)</span>
    <div class="toolbar-controls">
        <button onclick="zoomIn()" title="Acercar">+ Zoom</button>
        <span class="zoom-display" id="zoomLevel">100%</span>
        <button onclick="zoomOut()" title="Alejar">- Zoom</button>
        <button onclick="resetView()" title="Ajustar todo">Ajustar</button>
        <button onclick="centerView()" title="Centrar">Centrar</button>
        <span class="sep"></span>
        <button onclick="openModal()" title="Ver mapa en texto" style="background:rgba(212,168,67,0.3);border-color:#D4A843;">Ver en texto</button>
        <span class="hint">Scroll = zoom | Arrastra = mover</span>
    </div>
</div>

<!-- ══ Canvas ══ -->
<div class="canvas-wrap" id="canvasWrap">
    <div id="diagram-container">
        <pre class="mermaid">
---
config:
  layout: fixed
  theme: neo
  look: classic
---
flowchart LR
    A["Mandarín a Español"] --> B["INICIO"] & C["BLOG"] & D["INMERSIÓN"] & E["HERRAMIENTAS"] & F["RECURSOS"] & G["TIENDA"] & H["SOBRE MÍ"]
    B --> B1["Hero con Última Entrada"] & B2["Grid de Recursos Destacados"] & B3["Sección Mi Progreso HSK"] & B4["Newsletter Suscripción"]
    C --> C1["Diario HSK, Niveles 1-6"] & C2["Fonética para Hispanohablantes"] & C3["Errores Comunes"] & C4["Cultura Lingüística"] & C5["Tags: Tonos, Caracteres, etc"]
    D --> D1["Contenido Audiovisual"] & D2["Audio"] & D3["Lectura"] & D4["Redes Sociales Chinas"] & D5["Apps y Herramientas"]
    D1 --> D1a["Programas de TV"] & D1b["Canales de YouTube"] & D1c["Anime en Chino"] & D1d["Series y Películas"] & D1e["Documentales"]
    D2 --> D2a["Podcasts Mandarín"] & D2b["Música QQ y NetEase"] & D2c["Apps de Audio"]
    D3 --> D3a["Manga Manhua"] & D3b["Libros Recomendados"] & D3c["Historias Cortas"] & D3d["Poemas Clásicos"] & D3e["Revistas Digitales"]
    D4 --> D4a["RedNote XiaoHongShu"] & D4b["Weibo"] & D4c["Douyin"] & D4d["Bilibili"]
    D5 --> D5a["Diccionarios Pleco"] & D5b["Flashcards Anki"] & D5c["Teclados Input Methods"]
    E --> E1["HanziFlow App React"] & E2["Generador Hojas Trazos"]
    E1 --> E1a["Demo Gratuita"] & E1b["Versión Completa"]
    F --> F1["Mazos Anki Chino-Español"] & F2["Guías PDF"] & F3["Lista HSK Traducida"] & F4["Tabla de Tonos"]
    G --> G1["Productos Digitales"] & G2["Suscripción Premium"] & G3["HanziFlow Pro"]
    H --> H1["Mi Historia con el Chino"] & H2["Progreso Actual"] & H3["Formulario de Contacto"]

    style A fill:#C41E3A,stroke:#8B1528,color:#fff
    style B fill:#D4A843,stroke:#B38A2D,color:#1a1a2e
    style C fill:#D4A843,stroke:#B38A2D,color:#1a1a2e
    style D fill:#D4A843,stroke:#B38A2D,color:#1a1a2e
    style E fill:#D4A843,stroke:#B38A2D,color:#1a1a2e
    style F fill:#D4A843,stroke:#B38A2D,color:#1a1a2e
    style G fill:#D4A843,stroke:#B38A2D,color:#1a1a2e
    style H fill:#D4A843,stroke:#B38A2D,color:#1a1a2e
        </pre>
    </div>
</div>

<!-- ══ Info overlay ══ -->
<div class="info-overlay">
    <kbd>Scroll</kbd> Zoom &nbsp;
    <kbd>Click + Arrastrar</kbd> Mover<br>
    <kbd>+</kbd> / <kbd>-</kbd> Zoom &nbsp;
    <kbd>0</kbd> Ajustar &nbsp;
    <kbd>C</kbd> Centrar &nbsp;
    <kbd>T</kbd> Ver texto
</div>

<!-- ══ Modal: Mapa en texto ══ -->
<div class="modal-overlay" id="textModal">
    <div class="modal-box">
        <div class="modal-header">
            <h3><span>橘</span> Mapa del Sitio (texto)</h3>
            <button class="modal-close" onclick="closeModal()">✕</button>
        </div>
        <div class="modal-body">
<pre>MANDARÍN A ESPAÑOL
|
+-- INICIO
|   |-- Hero: Última entrada del blog + CTA a HanziFlow
|   |-- Grid de recursos destacados
|   |-- Sección "Mi progreso" (barra visual HSK)
|   +-- Newsletter (suscripción)
|
+-- BLOG (Diario de Aprendizaje)
|   |-- Diario HSK (niveles 1-6)
|   |-- Fonética para hispanohablantes
|   |-- Errores comunes (interferencias español/chino)
|   |-- Cultura lingüística
|   +-- Tags: #Tono1 #Caracteres #Radicales #Gramática
|
+-- INMERSIÓN (Repositorio de recursos para inmersión)
|   |
|   +-- Contenido Audiovisual
|   |   |-- Programas de TV / Dramas
|   |   |-- Canales de YouTube
|   |   |-- Anime (en chino)
|   |   |-- Series y Películas
|   |   +-- Documentales
|   |
|   +-- Audio
|   |   |-- Podcasts (en chino mandarín)
|   |   |-- Música (QQ Música, NetEase)
|   |   +-- Apps de audio (Himalaya)
|   |
|   +-- Lectura
|   |   |-- Manga / Manhua
|   |   |-- Libros recomendados
|   |   |-- Historias cortas (graded readers)
|   |   |-- Poemas clásicos
|   |   +-- Revistas digitales
|   |
|   +-- Redes Sociales Chinas
|   |   |-- RedNote (XiaoHongShu)
|   |   |-- Weibo
|   |   |-- Douyin
|   |   +-- Bilibili
|   |
|   +-- Apps y Herramientas
|       |-- Diccionarios (Pleco, etc.)
|       |-- Flashcards (Anki, etc.)
|       +-- Teclados y input methods
|
+-- HERRAMIENTAS
|   |-- HanziFlow (App React integrada)
|   |   |-- Demo gratuita
|   |   +-- Versión completa
|   +-- Generador de hojas de trazos (futuro)
|
+-- RECURSOS (Zona de descargas)
|   |-- Mazos Anki chino-español
|   |-- Guías PDF
|   |-- Lista HSK con traducción contextual
|   +-- Tabla de tonos
|
+-- TIENDA / MEMBRESÍA (futuro)
|   |-- Productos digitales
|   |-- Suscripción Premium
|   +-- Acceso a HanziFlow Pro
|
+-- SOBRE MÍ / CONTACTO
    |-- Mi historia con el chino
    |-- Progreso actual
    +-- Formulario de contacto</pre>
        </div>
        <div class="modal-footer">
            <span>mandarinaespañol.com | Arquitectura de información</span>
            <button onclick="copyTree()">Copiar texto</button>
        </div>
    </div>
</div>

<!-- Mermaid -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>

<script>
(function() {
    // ── State ──
    let scale = 1;
    let translateX = 0;
    let translateY = 0;
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let lastTranslateX = 0;
    let lastTranslateY = 0;

    const MIN_SCALE = 0.15;
    const MAX_SCALE = 4;
    const ZOOM_STEP = 0.15;

    const container = document.getElementById('diagram-container');
    const canvasWrap = document.getElementById('canvasWrap');
    const zoomDisplay = document.getElementById('zoomLevel');

    // ── Init Mermaid ──
    mermaid.initialize({
        startOnLoad: true,
        theme: 'neo',
        securityLevel: 'loose',
        flowchart: {
            curve: 'basis',
            padding: 15,
            htmlLabels: true,
            defaultRenderer: 'elk'
        }
    });

    // ── Render update ──
    function applyTransform(smooth) {
        if (smooth) {
            container.classList.add('smooth-transition');
            setTimeout(() => container.classList.remove('smooth-transition'), 320);
        } else {
            container.classList.remove('smooth-transition');
        }
        container.style.transform =
            'translate(' + translateX + 'px, ' + translateY + 'px) scale(' + scale + ')';
        zoomDisplay.textContent = Math.round(scale * 100) + '%';
    }

    // ── Zoom at point ──
    function zoomAtPoint(newScale, cx, cy) {
        newScale = Math.max(MIN_SCALE, Math.min(MAX_SCALE, newScale));
        const ratio = newScale / scale;
        translateX = cx - ratio * (cx - translateX);
        translateY = cy - ratio * (cy - translateY);
        scale = newScale;
        applyTransform(false);
    }

    // ── Mouse wheel zoom ──
    canvasWrap.addEventListener('wheel', function(e) {
        e.preventDefault();
        const rect = canvasWrap.getBoundingClientRect();
        const cx = e.clientX - rect.left;
        const cy = e.clientY - rect.top;
        const delta = e.deltaY > 0 ? -ZOOM_STEP : ZOOM_STEP;
        zoomAtPoint(scale + delta, cx, cy);
    }, { passive: false });

    // ── Pan (drag) ──
    canvasWrap.addEventListener('mousedown', function(e) {
        if (e.button !== 0) return;
        isDragging = true;
        dragStartX = e.clientX;
        dragStartY = e.clientY;
        lastTranslateX = translateX;
        lastTranslateY = translateY;
        canvasWrap.classList.add('dragging');
    });
    window.addEventListener('mousemove', function(e) {
        if (!isDragging) return;
        translateX = lastTranslateX + (e.clientX - dragStartX);
        translateY = lastTranslateY + (e.clientY - dragStartY);
        applyTransform(false);
    });
    window.addEventListener('mouseup', function() {
        isDragging = false;
        canvasWrap.classList.remove('dragging');
    });

    // ── Touch support ──
    let lastTouchDist = 0;
    canvasWrap.addEventListener('touchstart', function(e) {
        if (e.touches.length === 1) {
            isDragging = true;
            dragStartX = e.touches[0].clientX;
            dragStartY = e.touches[0].clientY;
            lastTranslateX = translateX;
            lastTranslateY = translateY;
        } else if (e.touches.length === 2) {
            isDragging = false;
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            lastTouchDist = Math.sqrt(dx*dx + dy*dy);
        }
    }, { passive: true });
    canvasWrap.addEventListener('touchmove', function(e) {
        e.preventDefault();
        if (e.touches.length === 1 && isDragging) {
            translateX = lastTranslateX + (e.touches[0].clientX - dragStartX);
            translateY = lastTranslateY + (e.touches[0].clientY - dragStartY);
            applyTransform(false);
        } else if (e.touches.length === 2) {
            const dx = e.touches[0].clientX - e.touches[1].clientX;
            const dy = e.touches[0].clientY - e.touches[1].clientY;
            const dist = Math.sqrt(dx*dx + dy*dy);
            const midX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
            const midY = (e.touches[0].clientY + e.touches[1].clientY) / 2;
            const rect = canvasWrap.getBoundingClientRect();
            const cx = midX - rect.left;
            const cy = midY - rect.top;
            zoomAtPoint(scale * (dist / lastTouchDist), cx, cy);
            lastTouchDist = dist;
        }
    }, { passive: false });
    canvasWrap.addEventListener('touchend', function() { isDragging = false; });

    // ── Keyboard shortcuts ──
    window.addEventListener('keydown', function(e) {
        if (document.getElementById('textModal').classList.contains('open')) {
            if (e.key === 'Escape') closeModal();
            return;
        }
        const tag = (e.target.tagName || '').toLowerCase();
        if (tag === 'input' || tag === 'textarea') return;
        const rect = canvasWrap.getBoundingClientRect();
        const cx = rect.width / 2;
        const cy = rect.height / 2;
        switch(e.key) {
            case '+': case '=':
                zoomAtPoint(scale + ZOOM_STEP, cx, cy); break;
            case '-': case '_':
                zoomAtPoint(scale - ZOOM_STEP, cx, cy); break;
            case '0':
                resetView(); break;
            case 'c': case 'C':
                centerView(); break;
            case 't': case 'T':
                openModal(); break;
        }
    });

    // ── Toolbar buttons ──
    window.zoomIn = function() {
        const rect = canvasWrap.getBoundingClientRect();
        zoomAtPoint(scale + ZOOM_STEP, rect.width/2, rect.height/2);
    };
    window.zoomOut = function() {
        const rect = canvasWrap.getBoundingClientRect();
        zoomAtPoint(scale - ZOOM_STEP, rect.width/2, rect.height/2);
    };
    window.resetView = function() {
        const svg = container.querySelector('svg');
        if (!svg) return;
        const wrapRect = canvasWrap.getBoundingClientRect();
        const svgW = svg.getBoundingClientRect().width / scale;
        const svgH = svg.getBoundingClientRect().height / scale;
        const pad = 80;
        const fitScaleX = (wrapRect.width - pad) / (svgW + 80);
        const fitScaleY = (wrapRect.height - pad) / (svgH + 80);
        scale = Math.min(fitScaleX, fitScaleY, 1.5);
        scale = Math.max(MIN_SCALE, scale);
        translateX = (wrapRect.width - svgW * scale) / 2 - 40 * scale;
        translateY = (wrapRect.height - svgH * scale) / 2 - 40 * scale + 40;
        applyTransform(true);
    };
    window.centerView = function() {
        const svg = container.querySelector('svg');
        if (!svg) return;
        const wrapRect = canvasWrap.getBoundingClientRect();
        const svgW = svg.getBoundingClientRect().width / scale;
        const svgH = svg.getBoundingClientRect().height / scale;
        translateX = (wrapRect.width - svgW * scale) / 2 - 40 * scale;
        translateY = (wrapRect.height - svgH * scale) / 2 - 40 * scale + 40;
        applyTransform(true);
    };

    // ── Modal ──
    window.openModal = function() {
        document.getElementById('textModal').classList.add('open');
    };
    window.closeModal = function() {
        document.getElementById('textModal').classList.remove('open');
    };
    window.copyTree = function() {
        const pre = document.querySelector('#textModal .modal-body pre');
        navigator.clipboard.writeText(pre.textContent).then(function() {
            const btn = document.querySelector('#textModal .modal-footer button');
            btn.textContent = 'Copiado';
            setTimeout(function() { btn.textContent = 'Copiar texto'; }, 1500);
        });
    };
    // Click outside modal to close
    document.getElementById('textModal').addEventListener('click', function(e) {
        if (e.target === this) closeModal();
    });

    // ── Auto-fit on load ──
    window.addEventListener('load', function() {
        setTimeout(function() { resetView(); }, 800);
    });
})();
</script>
</body>
</html>
